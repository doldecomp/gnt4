.include "macros.inc"

.section .text  # 0x80178D98 - 0x80178F18

.global DSPCheckMailToDSP
DSPCheckMailToDSP:
/* 80178D98 00175D98  3C 60 CC 00 */	lis r3, 0xCC005000@ha
/* 80178D9C 00175D9C  A0 03 50 00 */	lhz r0, 0xCC005000@l(r3)
/* 80178DA0 00175DA0  54 03 8F FE */	rlwinm r3, r0, 0x11, 0x1f, 0x1f
/* 80178DA4 00175DA4  4E 80 00 20 */	blr 

.global DSPCheckMailFromDSP
DSPCheckMailFromDSP:
/* 80178DA8 00175DA8  3C 60 CC 00 */	lis r3, 0xCC005004@ha
/* 80178DAC 00175DAC  A0 03 50 04 */	lhz r0, 0xCC005004@l(r3)
/* 80178DB0 00175DB0  54 03 8F FE */	rlwinm r3, r0, 0x11, 0x1f, 0x1f
/* 80178DB4 00175DB4  4E 80 00 20 */	blr 

.global DSPReadMailFromDSP
DSPReadMailFromDSP:
/* 80178DB8 00175DB8  3C 60 CC 00 */	lis r3, 0xCC005000@ha
/* 80178DBC 00175DBC  38 63 50 00 */	addi r3, r3, 0xCC005000@l
/* 80178DC0 00175DC0  A0 03 00 04 */	lhz r0, 4(r3)
/* 80178DC4 00175DC4  A0 63 00 06 */	lhz r3, 6(r3)
/* 80178DC8 00175DC8  50 03 80 1E */	rlwimi r3, r0, 0x10, 0, 0xf
/* 80178DCC 00175DCC  4E 80 00 20 */	blr 

.global DSPSendMailToDSP
DSPSendMailToDSP:
/* 80178DD0 00175DD0  3C 80 CC 00 */	lis r4, 0xCC005000@ha
/* 80178DD4 00175DD4  54 60 84 3E */	srwi r0, r3, 0x10
/* 80178DD8 00175DD8  B0 04 50 00 */	sth r0, 0xCC005000@l(r4)
/* 80178DDC 00175DDC  B0 64 50 02 */	sth r3, 0x5002(r4)
/* 80178DE0 00175DE0  4E 80 00 20 */	blr 

.global DSPInit
DSPInit:
/* 80178DE4 00175DE4  7C 08 02 A6 */	mflr r0
/* 80178DE8 00175DE8  3C 60 80 21 */	lis r3, lbl_80216CC0@ha
/* 80178DEC 00175DEC  90 01 00 04 */	stw r0, 4(r1)
/* 80178DF0 00175DF0  38 A3 6C C0 */	addi r5, r3, lbl_80216CC0@l
/* 80178DF4 00175DF4  4C C6 31 82 */	crclr 6
/* 80178DF8 00175DF8  38 65 00 48 */	addi r3, r5, 0x48
/* 80178DFC 00175DFC  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80178E00 00175E00  38 85 00 68 */	addi r4, r5, 0x68
/* 80178E04 00175E04  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80178E08 00175E08  38 A5 00 74 */	addi r5, r5, 0x74
/* 80178E0C 00175E0C  48 00 01 0D */	bl __DSP_debug_printf
/* 80178E10 00175E10  80 0D 8D E8 */	lwz r0, lbl_80277708@sda21(r13)
/* 80178E14 00175E14  2C 00 00 01 */	cmpwi r0, 1
/* 80178E18 00175E18  41 82 00 7C */	beq lbl_80178E94
/* 80178E1C 00175E1C  80 6D 81 D8 */	lwz r3, lbl_80276AF8@sda21(r13)
/* 80178E20 00175E20  4B FE CB 7D */	bl OSRegisterVersion
/* 80178E24 00175E24  4B FF 0D 35 */	bl OSDisableInterrupts
/* 80178E28 00175E28  3C 80 80 18 */	lis r4, __DSPHandler@ha
/* 80178E2C 00175E2C  3B E3 00 00 */	addi r31, r3, 0
/* 80178E30 00175E30  38 84 8F 68 */	addi r4, r4, __DSPHandler@l
/* 80178E34 00175E34  38 60 00 07 */	li r3, 7
/* 80178E38 00175E38  4B FF 0D 6D */	bl __OSSetInterruptHandler
/* 80178E3C 00175E3C  3C 60 01 00 */	lis r3, 0x100
/* 80178E40 00175E40  4B FF 11 69 */	bl __OSUnmaskInterrupts
/* 80178E44 00175E44  3C 60 CC 00 */	lis r3, 0xCC005000@ha
/* 80178E48 00175E48  38 C3 50 00 */	addi r6, r3, 0xCC005000@l
/* 80178E4C 00175E4C  A0 63 50 0A */	lhz r3, 0x500a(r3)
/* 80178E50 00175E50  38 00 FF 57 */	li r0, -169
/* 80178E54 00175E54  7C 60 00 38 */	and r0, r3, r0
/* 80178E58 00175E58  60 00 08 00 */	ori r0, r0, 0x800
/* 80178E5C 00175E5C  B0 06 00 0A */	sth r0, 0xa(r6)
/* 80178E60 00175E60  38 A0 FF 53 */	li r5, -173
/* 80178E64 00175E64  38 80 00 00 */	li r4, 0
/* 80178E68 00175E68  A0 E6 00 0A */	lhz r7, 0xa(r6)
/* 80178E6C 00175E6C  38 00 00 01 */	li r0, 1
/* 80178E70 00175E70  38 7F 00 00 */	addi r3, r31, 0
/* 80178E74 00175E74  7C E5 28 38 */	and r5, r7, r5
/* 80178E78 00175E78  B0 A6 00 0A */	sth r5, 0xa(r6)
/* 80178E7C 00175E7C  90 8D 8D F8 */	stw r4, lbl_80277718@sda21(r13)
/* 80178E80 00175E80  90 8D 8E 04 */	stw r4, lbl_80277724@sda21(r13)
/* 80178E84 00175E84  90 8D 8D FC */	stw r4, lbl_8027771C@sda21(r13)
/* 80178E88 00175E88  90 8D 8E 00 */	stw r4, lbl_80277720@sda21(r13)
/* 80178E8C 00175E8C  90 0D 8D E8 */	stw r0, lbl_80277708@sda21(r13)
/* 80178E90 00175E90  4B FF 0C F1 */	bl OSRestoreInterrupts
lbl_80178E94:
/* 80178E94 00175E94  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80178E98 00175E98  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80178E9C 00175E9C  38 21 00 10 */	addi r1, r1, 0x10
/* 80178EA0 00175EA0  7C 08 03 A6 */	mtlr r0
/* 80178EA4 00175EA4  4E 80 00 20 */	blr 

.global DSPAddTask
DSPAddTask:
/* 80178EA8 00175EA8  7C 08 02 A6 */	mflr r0
/* 80178EAC 00175EAC  90 01 00 04 */	stw r0, 4(r1)
/* 80178EB0 00175EB0  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 80178EB4 00175EB4  93 E1 00 14 */	stw r31, 0x14(r1)
/* 80178EB8 00175EB8  93 C1 00 10 */	stw r30, 0x10(r1)
/* 80178EBC 00175EBC  7C 7E 1B 78 */	mr r30, r3
/* 80178EC0 00175EC0  4B FF 0C 99 */	bl OSDisableInterrupts
/* 80178EC4 00175EC4  3B E3 00 00 */	addi r31, r3, 0
/* 80178EC8 00175EC8  38 7E 00 00 */	addi r3, r30, 0
/* 80178ECC 00175ECC  48 00 07 ED */	bl __DSP_insert_task
/* 80178ED0 00175ED0  38 00 00 00 */	li r0, 0
/* 80178ED4 00175ED4  90 1E 00 00 */	stw r0, 0(r30)
/* 80178ED8 00175ED8  38 00 00 01 */	li r0, 1
/* 80178EDC 00175EDC  38 7F 00 00 */	addi r3, r31, 0
/* 80178EE0 00175EE0  90 1E 00 08 */	stw r0, 8(r30)
/* 80178EE4 00175EE4  4B FF 0C 9D */	bl OSRestoreInterrupts
/* 80178EE8 00175EE8  80 0D 8E 00 */	lwz r0, lbl_80277720@sda21(r13)
/* 80178EEC 00175EEC  7C 1E 00 40 */	cmplw r30, r0
/* 80178EF0 00175EF0  40 82 00 0C */	bne lbl_80178EFC
/* 80178EF4 00175EF4  7F C3 F3 78 */	mr r3, r30
/* 80178EF8 00175EF8  48 00 06 35 */	bl __DSP_boot_task
lbl_80178EFC:
/* 80178EFC 00175EFC  7F C3 F3 78 */	mr r3, r30
/* 80178F00 00175F00  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 80178F04 00175F04  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 80178F08 00175F08  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 80178F0C 00175F0C  38 21 00 18 */	addi r1, r1, 0x18
/* 80178F10 00175F10  7C 08 03 A6 */	mtlr r0
/* 80178F14 00175F14  4E 80 00 20 */	blr 
